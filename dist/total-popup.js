function assignArgs(n,r){if(Object(n)!==n||Object(r)!==r)return r;for(const s in r)s in n&&(n[s]=assignArgs(n[s],r[s]));return n}
class TotalPopupTitlebar{constructor(i){this.parent=i.parent,this.icons={minimize:null,maximize:null,demaximize:null,close:null,locked:null},assignArgs(this.icons,i.icons),this.main=document.createElement("div"),this.main.style.display="flex",this.main.classList.add("titlebar"),"left"==i.side?(this.main.style.display="flex",this.icons.close&&(this.close=document.createElement("div"),this.main.append(this.close)),this.icons.minimize&&(this.minimize=document.createElement("div"),this.main.append(this.minimize)),this.icons.maximize&&(this.maximize=document.createElement("div"),this.main.append(this.maximize))):"right"==i.side&&(this.main.style.flexDirection="row-reverse",this.icons.close&&(this.close=document.createElement("div"),this.main.append(this.close)),this.icons.maximize&&(this.maximize=document.createElement("div"),this.main.append(this.maximize)),this.icons.minimize&&(this.minimize=document.createElement("div"),this.main.append(this.minimize))),this.icons.close&&(this.close.innerHTML=i.icons.close,this.close.classList.add("close"),this.close.classList.add("window-button")),this.icons.minimize&&(this.minimize.innerHTML=i.icons.minimize,this.minimize.classList.add("minimize"),this.minimize.classList.add("window-button")),this.icons.maximize&&(this.maximize.innerHTML=i.icons.maximize,this.maximize.classList.add("maximize"),this.maximize.classList.add("window-button")),this.title=document.createElement("div"),this.title.classList.add("title"),"title"in i&&i.title&&(this.title.innerHTML=i.title),this.main.append(this.title),i.container.append(this.main),this.icons.close&&this.close.addEventListener("pointerup",this.parent.close.bind(this.parent)),this.icons.minimize&&this.minimize.addEventListener("pointerup",this.parent.minimize.bind(this.parent)),this.icons.maximize&&this.maximize.addEventListener("pointerup",this.parent.maximize.bind(this.parent))}height(){return this.main.getBoundingClientRect().height}}
class TotalPopupBorder{constructor(t,i=!1){this.main=document.createElement("div"),this.main.classList.add("border"),this.main.classList.add(t),i&&this.main.classList.add("resize")}show(){this.main.style.removeProperty("width"),this.main.style.removeProperty("height")}hide(){this.main.style.width="0",this.main.style.height="0"}}
class TotalPopupInner{constructor(t){this.parent=t.parent,this.main=document.createElement("div"),"onClick"in t&&null!=t.onClick&&this.main.addEventListener("click",t.onClick),"content"in t&&null!=t.content&&this.add(t.content),this.main.classList.add("content"),this.content=null}add(t){"string"==typeof t?this.main.innerHTML=t:"HTMLElement"==Object.getPrototypeOf(t.constructor).name?this.main.append(t):"object"==typeof t&&(this.content=t,this.main.append(t.main),"parent"in t&&(t.parent=this.parent))}del(){this.content&&delete this.content}}
class TotalTabs{constructor(t={}){const{width:s=200,height:i=45,newTab:a=null}=t;this.parent=null,this.id=crypto.randomUUID(),this.main=document.createElement("div"),this.main.classList.add("tabs"),this.main.style.position="relative",this.tabbar=document.createElement("div"),this.tabbar.classList.add("tabbar"),this.tabbar.id=this.id,this.tabbar.style.height=i+"px",this.content=document.createElement("div"),this.content.classList.add("content"),this.width=s,this.height=i,"newTab"in t&&this.assignTab(t.newTab),this.main.append(this.tabbar),this.main.append(this.content),this.list=[],this.dragTab=null,this.canSend=!1,this.callback={onDock:null,onUndock:null,onZeroTabs:null},assignArgs(this.callback,t.callback),this.transform={dock:!0,undock:!0,offset:{startPos:{x:0,y:0},x1:0,y1:0,x2:0,y2:0,start:function(t,s){this.x1=this.x2=this.startPos.x=t,this.y1=this.y2=this.startPos.y=s},update:function(t,s){this.x2=t,this.y2=s},get:function(){const t=[this.x2-this.x1,this.y2-this.y1];return this.x1=this.x2,this.y1=this.y2,t}}},this.startDragEvent=this.startDrag.bind(this),this.dragEvent=this.drag.bind(this),this.endDragEvent=this.endDrag.bind(this),this.main.addEventListener("pointerdown",this.startDragEvent)}show(){this.main.style.display="block"}hide(){this.main.style.display="none"}startDrag(t){t.stopPropagation(),t.target.classList.contains("active")&&(this.transform.offset.start(t.x,t.y),this.dragTab=this.getActiveTab(),this.dragTab.tab.classList.remove("animated"),this.tabbar.append(this.dragTab.tab),this.canSend=!0,document.body.addEventListener("pointermove",this.dragEvent),document.body.addEventListener("pointerup",this.endDragEvent))}drag(t){if(t.stopPropagation(),null!=this.dragTab){this.transform.offset.update(t.x,t.y);const s=this.transform.offset.get()[0];if(this.dragTab.transform.x+s>=0&&this.dragTab.transform.x+this.width+s<this.tabbar.offsetWidth&&(this.dragTab.transform.x+=s,this.dragTab.update(),Math.abs(this.transform.offset.startPos.x-this.transform.offset.x1)>this.width-10))if(this.transform.offset.startPos.x-this.transform.offset.x1>0){const t=this.list[this.list.indexOf(this.dragTab)-1];if(null!=t){t.transform.x+=this.width,t.update(),this.transform.offset.startPos.x=this.transform.offset.x1;const s=this.list[this.list.indexOf(this.dragTab)];this.list[this.list.indexOf(this.dragTab)]=this.list[this.list.indexOf(t)],this.list[this.list.indexOf(t)]=s}}else if(this.transform.offset.startPos.x-this.transform.offset.x1<0&&this.list.indexOf(this.dragTab)<this.list.length-1){const t=this.list[this.list.indexOf(this.dragTab)+1];if(null!=t){t.transform.x-=this.width,t.update(),this.transform.offset.startPos.x=this.transform.offset.x1;const s=this.list[this.list.indexOf(t)];this.list[this.list.indexOf(t)]=this.list[this.list.indexOf(this.dragTab)],this.list[this.list.indexOf(this.dragTab)]=s}}if(this.transform.undock&&this.canSend&&this.list.length>1&&(Math.abs(this.transform.offset.startPos.y-this.transform.offset.y1)>100||Math.abs(this.transform.offset.startPos.x-this.transform.offset.x1)>this.width+30)){this.callback.onUndock&&(this.callback.onUndock=null);const t=this.list.indexOf(this.dragTab);-1!==t&&this.list.splice(t,1),this.dragTab.transform.x=0,this.dragTab.update(),this.dragTab=null,this.sortTabs(),this.enableFirstTab(),this.canSend=!1,document.body.removeEventListener("pointermove",this.dragEvent),document.body.removeEventListener("pointerup",this.endDragEvent)}}}endDrag(t){t.stopPropagation(),document.body.removeEventListener("pointermove",this.dragEvent),document.body.removeEventListener("pointerup",this.endDragEvent);for(const s of t.composedPath())if("DIV"==s.nodeName&&s.classList.contains("tabbar")&&s.id!=this.tabbar.id&&this.callback.onDock)return this.callback.onDock(this.dragTab,s.id),void(this.dragTab=null);null!=this.dragTab&&this.list.includes(this.dragTab)&&(this.dragTab.tab.classList.add("animated"),this.dragTab.tab.parentNode.append(this.dragTab.tab),this.dragTab.transform.x=this.width*this.list.indexOf(this.dragTab),this.dragTab.update(),this.dragTab=null)}addTab(t,s){const i=new TotalTab({name:t,content:s,width:this.width,height:this.height,tabs:this,icon:"&#215;"});this.list.push(i),this.tabbar.append(i.tab),this.content.append(i.content.content);for(const t of this.list)t.hideContent();i.showContent()}assignTab(t){t.tabs=this,this.list.push(t),this.tabbar.append(t.tab),this.content.append(t.content.content),this.sortTabs();for(const t of this.list)t.hideContent();t.showContent()}hideTabsContent(){for(const t of this.list)t.hideContent()}removeTab(t){const s=this.list.indexOf(t);-1!==s&&this.list.splice(s,1),this.sortTabs(),this.list.length>1?this.enableFirstTab():null!=this.callback.onZeroTabs&&this.callback.onZeroTabs(this.id)}getActiveTab(){for(const t of this.list)if(t.tab.classList.contains("active"))return t;return null}sortTabs(){for(const t of this.list)t.transform.x=this.width*this.list.indexOf(t),t.update()}enableFirstTab(){this.list[0].showContent()}}class TotalTab{constructor(t){this.tabs=t.tabs,this.transform={x:t.width*this.tabs.list.length,y:0,width:t.width,center:t.width/2},this.tab=document.createElement("div"),this.tab.innerHTML=t.name,this.tab.classList.add("tab"),this.tab.classList.add("animated"),this.tab.style.position="absolute",this.tab.style.left=this.transform.x+"px",this.tab.style.top="0px","number"==typeof t.width?this.tab.style.width="calc("+t.width+"px - 2px)":"string"==typeof t.width&&(this.tab.style.width=t.width),this.tab.style.height=`calc(${t.height}px - 2px)`,this.tab.style.display="flex",this.close=document.createElement("div"),this.close.innerHTML=t.icon,this.close.classList.add("close"),"left"==t.side?this.tab.insertBefore(this.close,this.tab.firstChild):this.tab.append(this.close),this.content=new TotalTabPage(t.content),this.tab.addEventListener("pointerdown",this.showContent.bind(this)),this.close.addEventListener("pointerup",this.closeTab.bind(this))}closeTab(t){for(const s of t.composedPath())if(s.classList.contains("close")){this.tabs.removeTab(this),this.tab.remove(),this.content.content.remove();break}}showContent(){this.tabs.hideTabsContent(),this.tab.classList.add("active"),this.content.show()}hideContent(){this.content.hide(),this.tab.classList.contains("active")&&this.tab.classList.remove("active")}update(){this.tab.style.left=this.transform.x+"px"}}class TotalTabPage{constructor(t){this.content=document.createElement("div"),this.content.classList.add("page"),this.content.innerHTML=t}show(){this.content.style.display="flex"}hide(){this.content.style.display="none"}}
class TotalPopupWindow{constructor(t=null){this.transform={x:null,y:null,width:500,height:500,minWidth:250,minHeight:250,maxWidth:1500,maxHeight:1500,margin:{top:15,bottom:15,left:15,right:15},borderWidth:4,offset:{x1:0,y1:0,x2:0,y2:0,start:function(t,i){this.x1=this.x2=t,this.y1=this.y2=i},update:function(t,i){this.x2=t,this.y2=i},get:function(){const t=[this.x2-this.x1,this.y2-this.y1];return this.x1=this.x2,this.y1=this.y2,t}},resizable:!0},assignArgs(this.transform,t),this.callback={onMinimize:null,onDeminimize:null,onMaximize:null,onDemaximize:null,onClose:null,onResize:null},assignArgs(this.callback,t.callback),this.target=null,this.mode="window",this.hidden=!1,this.closeLocked=!1,this.history={transform:{...this.transform},mode:this.mode,display:null,title:null,store:()=>{const{title:i=null}=t;this.history.transform.x=this.transform.x,this.history.transform.y=this.transform.y,this.history.transform.width=this.transform.width,this.history.transform.height=this.transform.height,this.history.transform.minWidth=this.transform.minWidth,this.history.transform.minHeight=this.transform.minHeight,this.history.transform.maxWidth=this.transform.maxWidth,this.history.transform.maxHeight=this.transform.maxHeight,this.history.mode=this.mode,this.history.display=this.content?.style?.display||"block",this.history.title=this.titlebar.title.innerHTML},restore:()=>{this.transform.x=this.history.transform.x,this.transform.y=this.history.transform.y,this.transform.width=this.history.transform.width,this.transform.height=this.history.transform.height,this.transform.minWidth=this.history.transform.minWidth,this.transform.minHeight=this.history.transform.minHeight,this.transform.maxWidth=this.history.transform.maxWidth,this.transform.maxHeight=this.history.transform.maxHeight,this.mode=this.history.mode,this.titlebar.title.innerHTML=this.history.title}},this.element=document.createElement("div"),this.element.style.position="absolute",this.element.style.display="grid",this.element.style.gridTemplateColumns=`${this.transform.borderWidth}px auto ${this.transform.borderWidth}px`,this.element.style.gridTemplateRows=`${this.transform.borderWidth}px auto ${this.transform.borderWidth}px`,this.element.classList.add("total-popup-window"),this.bottomRight=new TotalPopupBorder("bottom-right",this.transform.resizable),this.bottomLeft=new TotalPopupBorder("bottom-left",this.transform.resizable),this.topLeft=new TotalPopupBorder("top-left",this.transform.resizable),this.topRight=new TotalPopupBorder("top-right",this.transform.resizable),this.top=new TotalPopupBorder("top",this.transform.resizable),this.bottom=new TotalPopupBorder("bottom",this.transform.resizable),this.left=new TotalPopupBorder("left",this.transform.resizable),this.right=new TotalPopupBorder("right",this.transform.resizable),this.middle=document.createElement("div"),this.middle.style.display="flex",this.middle.style.flexDirection="column",this.middle.classList.add("middle");const i={side:"right",icons:{minimize:"&#11451;",maximize:"&#43;",demaximize:"&#43;",close:"&#215;",locked:"&#129181;"}};assignArgs(i,t),this.titlebar=null,(i.icons.minimize||i.icons.maximize||i.icons.demaximize||i.icons.close||i.icons.locked)&&(this.titlebar=new TotalPopupTitlebar({title:"title"in t?t.title:null,container:this.middle,parent:this,...i})),this.inner=new TotalPopupInner({parent:this,content:"content"in t?t.content:null,onClick:"callback"in t&&"onClick"in t.callback?t.callback.onClick:null}),this.middle.append(this.inner.main),this.content="content"in t?t.content:null,this.element.append(this.topLeft.main),this.element.append(this.top.main),this.element.append(this.topRight.main),this.element.append(this.left.main),this.element.append(this.middle),this.element.append(this.right.main),this.element.append(this.bottomLeft.main),this.element.append(this.bottom.main),this.element.append(this.bottomRight.main),this.container=t.container||document.querySelector("body"),this.container.append(this.element),null==this.transform.x&&null==this.transform.y&&(this.transform.x=document.body.clientWidth/2-this.transform.width/2,this.transform.y=document.body.clientHeight/2-this.transform.height/2),this.update(),this.dragStartEvent=this.dragStart.bind(this),this.dragMoveEvent=this.dragMove.bind(this),this.dragEndEvent=this.dragEnd.bind(this),this.element.addEventListener("pointerdown",this.dragStartEvent),document.addEventListener("mouseout",(t=>{const i=t.relatedTarget||t.toElement;i&&"HTML"!=i.nodeName||this.dragEnd()}))}dragStart(t){"fullscreen"!=this.mode&&(this.target=this.getTarget(t.composedPath(),["border","content","titlebar","total-popup-window"]),null!=this.target&&(this.element.parentNode.append(this.element),this.container.addEventListener("pointermove",this.dragMoveEvent),this.container.addEventListener("pointerup",this.dragEndEvent),this.transform.offset.start(t.x,t.y)))}dragMove(t){null!=this.target&&(this.transform.offset.update(t.x,t.y),this.updatePosition(this.target),this.update())}dragEnd(){this.container.removeEventListener("pointermove",this.dragMoveEvent),this.container.removeEventListener("pointerup",this.dragEndEvent),this.callback.onResize&&this.target&&this.target.classList.contains("border")&&this.callback.onResize(),this.target=null}getTarget(t,i){for(const s of t)if("DIV"==s.nodeName&&i.some((t=>s.classList.contains(t))))return s;return null}updatePosition(t){const[i,s]=this.transform.offset.get();t.classList.contains("bottom-right")&&this.transform.resizable?(this.transform.height+s>=this.transform.minHeight&&this.transform.height+s<=this.transform.maxHeight&&(this.transform.height+=s),this.transform.width+i>=this.transform.minWidth&&this.transform.width+i<=this.transform.maxWidth&&(this.transform.width+=i)):t.classList.contains("bottom-left")&&this.transform.resizable?(this.transform.height+s>=this.transform.minHeight&&this.transform.height+s<=this.transform.maxHeight&&(this.transform.height+=s),this.transform.width-i>=this.transform.minWidth&&this.transform.width-i<=this.transform.maxWidth&&(this.transform.x+=i,this.transform.width-=i)):t.classList.contains("top-left")&&this.transform.resizable?(this.transform.height-s>=this.transform.minHeight&&this.transform.height-s<=this.transform.maxHeight&&(this.transform.y+=s,this.transform.height-=s),this.transform.width-i>=this.transform.minWidth&&this.transform.width-i<=this.transform.maxWidth&&(this.transform.x+=i,this.transform.width-=i)):t.classList.contains("top-right")&&this.transform.resizable?(this.transform.height-s>=this.transform.minHeight&&this.transform.height-s<=this.transform.maxHeight&&(this.transform.y+=s,this.transform.height-=s),this.transform.width+i>=this.transform.minWidth&&this.transform.width+i<=this.transform.maxWidth&&(this.transform.width+=i)):t.classList.contains("top")&&this.transform.resizable?this.transform.height-s>=this.transform.minHeight&&this.transform.height-s<=this.transform.maxHeight&&(this.transform.y+=s,this.transform.height-=s):t.classList.contains("bottom")&&this.transform.resizable?this.transform.height+s>=this.transform.minHeight&&this.transform.height+s<=this.transform.maxHeight&&(this.transform.height+=s):t.classList.contains("left")&&this.transform.resizable?this.transform.width-i>=this.transform.minWidth&&this.transform.width-i<=this.transform.maxWidth&&(this.transform.x+=i,this.transform.width-=i):t.classList.contains("right")&&this.transform.resizable?this.transform.width+i>=this.transform.minWidth&&this.transform.width+i<=this.transform.maxWidth&&(this.transform.width+=i):(t.classList.contains("total-popup-window")||t.classList.contains("content")||t.classList.contains("titlebar"))&&(this.transform.x+=i,this.transform.y+=s)}update(){this.element.style.transform=`translate(${this.transform.x}px, ${this.transform.y}px)`;const t=Math.max(Math.max(this.transform.width,this.transform.minWidth),Math.min(this.transform.width,this.transform.maxWidth)),i=Math.max(Math.max(this.transform.height,this.transform.minHeight),Math.min(this.transform.height,this.transform.maxHeight));this.element.style.width=`${t}px`,this.element.style.height=`${i}px`,this.middle.style.width=t-2*this.transform.borderWidth+"px";const s=this.titlebar?this.titlebar.main.offsetHeight:0;this.middle.style.height=i-2*this.transform.borderWidth-s+"px"}show(){this.container.addEventListener("pointerdown",this.dragStartEvent),this.container.addEventListener("pointermove",this.dragMoveEvent),this.container.addEventListener("pointerup",this.dragEndEvent),this.element.style.display="grid",this.hidden=!1}hide(){this.container.removeEventListener("pointerdown",this.dragStartEvent),this.container.removeEventListener("pointermove",this.dragMoveEvent),this.container.removeEventListener("pointerup",this.dragEndEvent),this.element.style.display="none",this.hidden=!0}toggle(){this.hidden?this.show():this.hide()}maximize(){"window"==this.mode?(this.history.store(),this.mode="fullscreen",this.titlebar.maximize.innerHTML=this.titlebar.icons.demaximize,this.transform.x=0,this.transform.y=0,this.transform.width=document.body.clientWidth,this.transform.height=document.body.clientHeight,this.update(),this.callback.onMaximize&&this.callback.onMaximize()):"fullscreen"==this.mode?(this.history.restore(),this.titlebar.maximize.innerHTML=this.titlebar.icons.maximize,this.update(),this.callback.onDemaximize&&this.callback.onDemaximize()):"miniature"==this.mode&&(this.callback.onDeminimize&&this.callback.onDeminimize(),this.deminiaturize(),this.update())}minimize(){this.callback.onMinimize?this.callback.onMinimize():this.hide()}miniaturize(t={}){const{width:i=64,height:s=64,title:r=null}=t;this.history.store(),"fullscreen"==this.mode?this.titlebar.maximize.innerHTML=this.titlebar.icons.maximize:"window"==this.mode&&(this.titlebar.maximize.innerHTML=this.titlebar.icons.demaximize),this.mode="miniature",this.element.style.transition="width 0.5s ease-out, height 0.5s ease-out, transform 0.5s ease-out",setInterval((()=>this.element.style.removeProperty("transition")),500),this.bottomRight.hide(),this.bottomLeft.hide(),this.topLeft.hide(),this.topRight.hide(),this.top.hide(),this.bottom.hide(),this.left.hide(),this.right.hide(),this.titlebar.minimize.style.display="none",this.content&&("style"in this.content?this.content.style.display="none":"object"==typeof this.content&&this.content.hide()),this.transform.width=i,this.transform.height=s,this.transform.minWidth=i,this.transform.minHeight=s;const e=document.querySelectorAll(".total-popup-window.miniature"),h="top"in t?-1/0:1/0;let n=0,o=h;for(const i of e){const s=i.style.transform.match(/translate\((\d+(?:\.\d+)?)px, (\d+(?:\.\d+)?)px\)/);if(s&&3===s.length){const i=parseFloat(s[1]),r=parseFloat(s[2]);("top"in t&&r>o||"bottom"in t&&r<o)&&(n=i,o=r)}}o==h?("left"in t&&(this.transform.x=t.left+this.transform.margin.left),"right"in t&&(this.transform.x=this.container.offsetWidth-t.right-this.transform.width-this.transform.margin.right),"top"in t&&(this.transform.y=t.top+this.transform.margin.top),"bottom"in t&&(this.transform.y=this.container.offsetHeight-t.bottom-this.transform.height-this.transform.margin.bottom)):("left"in t&&(this.transform.x=t.left+this.transform.margin.left),"right"in t&&(this.transform.x=n),"top"in t&&(this.transform.y=o+50),"bottom"in t&&(this.transform.y=o-50)),r&&(this.titlebar.title.innerHTML=r),this.miniature=!0,this.element.classList.add("miniature"),this.update()}deminiaturize(){this.history.restore(),this.bottomRight.show(),this.bottomLeft.show(),this.topLeft.show(),this.topRight.show(),this.top.show(),this.bottom.show(),this.left.show(),this.right.show(),this.titlebar.minimize.style.display="block","style"in this.content?this.content.style.display=this.history.display:"object"==typeof this.content&&this.content.show(),this.miniature=!1,this.element.classList.remove("miniature")}lockClose(){this.closeLocked=!0}unlockClose(){this.closeLocked=!1}close(){this.closeLocked||(this.callback.onClose&&this.callback.onClose(),this.inner.del(),this.element.remove())}fit(t="screen"){if("screen"==t){const t=document.body.clientWidth-(this.transform.margin.right+this.transform.margin.left),i=document.body.clientHeight-(this.transform.margin.bottom+this.transform.margin.top);this.transform.maxWidth>t?(this.transform.x=this.transform.margin.right,this.transform.width=t):(this.transform.x=document.body.clientWidth/2-this.transform.maxWidth/2,this.transform.width=this.transform.maxWidth),this.transform.maxHeight>i?(this.transform.y=this.transform.margin.top,this.transform.height=i):(this.transform.y=document.body.clientHeight/2-this.transform.maxHeight/2,this.transform.height=this.transform.maxHeight),this.update()}else if("content"==t){const t=this.middle.scrollWidth,i=this.middle.scrollHeight+this.titlebar.height();this.transform.width=t,this.transform.height=i,this.adjust()}}adjust(){if("miniature"!=this.mode){const t=document.body.clientWidth,i=document.body.clientHeight;this.transform.x+this.transform.width>t-this.transform.margin.right&&(this.transform.x=t-this.transform.width-this.transform.margin.right),this.transform.y+this.transform.height>i-this.transform.margin.bottom&&(this.transform.y=i-this.transform.height-this.transform.margin.bottom),this.transform.x<this.transform.margin.left&&(this.transform.x=this.transform.margin.left),this.transform.y<this.transform.margin.top&&(this.transform.y=this.transform.margin.top),this.update()}}retransform(t){assignArgs(this.transform,t),this.update()}}